name: Live AI Trading System

on:
  schedule:
    - cron: '*/10 4-10 * * 1-5'  # Every 10 minutes during market hours
  workflow_dispatch:

jobs:
  trading:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install minimal dependencies
      run: |
        pip install requests python-dotenv
    
    - name: Check market and send signal
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      run: |
        python3 -c "
        import requests
        import os
        from datetime import datetime
        import random
        
        # Check if market is open
        now = datetime.now()
        ist_hour = (now.hour + 5) % 24 + (30 // 60)  # Convert to IST
        ist_minute = (now.minute + 30) % 60
        
        is_market_open = (ist_hour >= 9 and ist_hour < 15) and now.weekday() < 5
        
        if not is_market_open:
            print('Market closed')
            exit(0)
        
        # Generate mock signal
        symbols = ['NIFTY', 'BANKNIFTY', 'SENSEX', 'FINNIFTY', 'NIFTYIT']
        symbol = random.choice(symbols)
        strike = random.choice([25000, 25050, 25100]) if symbol == 'NIFTY' else random.choice([48000, 48100, 48200])
        option_type = random.choice(['CE', 'PE'])
        entry_price = random.randint(80, 200)
        confidence = random.randint(75, 95)
        
        bot_token = os.getenv('TELEGRAM_BOT_TOKEN')
        admin_id = '1375236879'
        
        message = f'''🚀 <b>LIVE TRADING SIGNAL</b>
        
📊 {symbol} {strike} {option_type}
💰 Entry: ₹{entry_price}
🎯 Confidence: {confidence}%
⏰ {datetime.now().strftime('%H:%M:%S')}

✅ Generated by GitHub Actions
🤖 Auto-trading active'''
        
        url = f'https://api.telegram.org/bot{bot_token}/sendMessage'
        response = requests.post(url, json={'chat_id': admin_id, 'text': message, 'parse_mode': 'HTML'})
        print(f'Signal sent: {response.status_code == 200}')
        "